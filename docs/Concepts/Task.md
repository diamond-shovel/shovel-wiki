# 任务(Task)是什么

任务(Task)负责在某些或某个节点上执行策略，并管理其生命周期。它是策略的执行载体，包含了策略的所有配置和插件，并负责协调各个插件的执行。

任务的基础参数包括:

| 属性 | 描述 | 类型 |
|---|---|---|
| id | 任务的唯一标识符 | int |
| name | 任务的名称 | str |
| start_time | 任务的开始时间 | Optional[str] |
| description | 任务的描述 | Optional[str] |
| status | 任务的状态 | str |
| progress | 任务的执行进度 | Optional[int] |
| raw_logs | 任务的原始日志 | Optional[str] |
| cron_str | 任务的Cron表达式（用于定时任务） | Optional[str] |
| strategy_id | 关联的策略ID | Optional[int] |
| asset_group_id | 关联的资产组ID | Optional[int] |
| assigned_slave_id | 分配的执行节点ID | Optional[int] |


## 任务的生命周期

任务的生命周期包括以下几个阶段：

1. **创建**：任务被创建时，接收用户的初始参数后，系统会根据策略的配置生成任务实例。  
2. **调度**：任务被调度到特定的节点上执行。调度器会根据策略和节点的配置决定任务的执行方式。  
3. **执行**：任务在节点上执行时，会按照策略的配置调用相应的插件。每个插件会在任务中执行其特定的功能。  
4. **完成**：任务执行完毕后，系统会收集执行插件在环境中产生的上下文（结果），并处理对应的后续操作。  

## 任务的初始参数

任务在创建时会接收一些初始参数，这些参数将会作为任务的上下文环境的一部分传递给插件。

* 由于此项目在构建初期定位为私有资产测绘平台，因此任务的初始参数主要是与资产相关的信息，后续可能会泛化。

这些参数通常包括：

| 属性 | 描述 | 类型 |
|---|---|---|
| in_company | 任务中涉及的公司名称列表 | Optional[list[str]] |
| in_ip | 任务中涉及的IP地址列表 | Optional[list[str]] |
| in_domain | 任务中涉及的域名列表 | Optional[list[str]] |

## 任务的调度

任务的在创建后不会自动执行，需要进行调度，若手动发送启动信号，将会自动调度并执行。

任务的调度分为手动与自动两种方式：

- **手动调度**：手动将任务强制绑定到某个节点上执行，若这个节点中装在的插件不满足策略的要求，则会进行错误处理。
- **自动调度**：系统根据策略中所需的插件，自动选择包含所需插件的节点进行任务执行。

## 任务的结果

任务在开始时会创建一个上下文环境(ctx)，或称上下文池，经插件的树状或链式读写操作后，最终会在ctx中创建并写入一些参数，这些参数即为任务的结果，任务将会在执行完毕后将这些结果保存。